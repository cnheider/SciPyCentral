{% extends "base.html" %}

{% block title %}{{pagetitle}}{% endblock %}

{% block content %}

<script>
<!--JQuery example: http://jqueryui.com/demos/autocomplete/#multiple-remote -->
$(function() {
	function split( val ) {
		return val.split( /,\s*/ );
	}
	function extractLast( term ) {
		return split( term ).pop();
	}

	$(".spc-autocomplete")
		// don't navigate away from the field on tab when selecting an item
		.bind( "keydown", function( event ) {
			if ( event.keyCode === $.ui.keyCode.TAB &&
					$( this ).data( "autocomplete" ).menu.active ) {
				event.preventDefault();
			}
		})
		.autocomplete({
			source: function( request, response ) {
				$.getJSON( "{% url spc-tagging-ajax %}", {
					term: extractLast( request.term )
				}, response );
			},
			search: function() {
				// custom minLength
				var term = extractLast( this.value );
				if ( term.length < 1 ) {
					return false;
				}
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ) {
				var terms = split( this.value );
				// remove the current input
				terms.pop();
				// add the selected item
				terms.push( ui.item.value );
				// add placeholder to get the comma-and-space at the end
				terms.push( "" );
				this.value = terms.join( ", " );
				return false;
			}
		});
});
</script>


<div class="spc-form">
<form action="" method="POST" class="spc-ul-form" enctype="multipart/form-data">
  {% csrf_token %}

  {% if item.errors %}
  <div id="spc-form-error-message"><p><b>Some errors were found</b>. Please see fields with
  <span class="spc-field-error">a coloured background</span></p></div>
  {% endif %}

  {% for field in item%}
    {% if field.is_hidden %}
      {{field.as_widget|safe}}
	{% else %}
	<div class="colmask threecol">
		<div class="colmid">
			<div class="colleft">
				<div class="col1 form-field">
					{{field.as_widget|safe}}
				</div>
				<div class="col2 {% if field.errors %}spc-field-error{% endif %}">
					<label for="{{field.id_for_label}}">{{field.label|safe}}</label>
					<span>{{ field.errors }}</span>
				</div>
				<div class="col3" id="help-{{field.id_for_label}}">
					<span class="spc-helptext">{{field.help_text|safe}}</span>
				</div>
			</div>
		</div>
	</div>
	{%endif %}
  {% endfor %}

  <div id="spc-preview-edit-submit">
		<div class="colmask threecol">
			<div class="colmid">
				<div class="colleft">
					<div class="col1 form-field">
						<input type="submit" name="spc-preview"
						value="{{buttontext}}" id="spc-item-preview"/>
					</div>
					<div class="col2">&nbsp;</div>
					<div class="col3">
						&nbsp;
					</div>
				</div>
			</div>
		</div>
	</div>
</form>
<div style="clear:both;"></div>
</div>


<div id="spc-imageupload" class="spc-form">

	<script type="text/javascript" src="{{MEDIA_URL}}jquery.form.js"></script>
	<script type="text/javascript">
	$(document).ready(function() {
	   var options = {
		   target:    '#spc-imageupload-output-ajax-adds-it', // target element(s) to be updated with server response
		   success: function() { $('#spc-imageupload-output-ajax-adds-it').fadeIn('slow'); },
		   url:       '{% url spc-screenshot-add %}',
		   type:      'post',
		   clearForm:  true,
		   resetForm:  true,
		};
		// bind form using 'ajaxForm'
		$('#spc-imageupload-add').ajaxForm(options);
	});

	<!--// post-submit callback-->
	<!--function showResponse(responseText, statusText, xhr, $form)  {-->
		<!--// for normal html responses, the first argument to the success callback-->
		<!--// is the XMLHttpRequest object's responseText property-->

		<!--// if the ajaxForm method was passed an Options Object with the dataType-->
		<!--// property set to 'xml' then the first argument to the success callback-->
		<!--// is the XMLHttpRequest object's responseXML property-->

		<!--// if the ajaxForm method was passed an Options Object with the dataType-->
		<!--// property set to 'json' then the first argument to the success callback-->
		<!--// is the json data object returned by the server-->

		<!--//alert('status: ' + statusText + '\n\nresponseText: \n' + responseText +-->
		<!--//	'\n\nThe output div should have already been updated with the responseText.');-->

		<!--// Edit the other form to add the pk of the screenshot to use as the-->
		<!--// thumbnail-->
	<!--}-->
	</script>

	<form id="spc-imageupload-add" action="{% url spc-screenshot-add%}" method="post" enctype="multipart/form-data">
	   {% csrf_token %}
		<div class="colmask threecol">
			<div class="colmid">
				<div class="colleft">
					<div class="col1 form-field">
						<input type="file" placeholder="Choose" id="spc_image_upload" name="spc_image_upload" />
					</div>
					<div class="col2">
						<label for="spc_image_upload">Optionally upload <b>image file(s)</b> to use in your description</label>
					</div>
					<div class="col3">
						<input type="submit" value="Upload image" id="spc-imageupload-button" /> (JPEG or PNG)
					</div>
				</div>
			</div>
		</div>
	</form>

	<div id="spc-imageupload-output-ajax-adds-it"></div>
	<div style="clear: both;"></div>
</div>
{% endblock %}
